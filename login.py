import requests
import re
import sys

url="http://192.168.56.100:8000/login.php"
#url="http://web/login.php"

def login():
    s = requests.Session()    
    set_page = s.get(url)
    CSRFName =re.search("'CSRFName\' value=\'(.+?)\'",set_page.text).group(1)
    CSRFToken = re.search("'CSRFToken\' value=\'(.+?)\'", set_page.text).group(1)
    data = {
        "tl_login": 'user',
        "tl_password": 'dxy0411',
        "CSRFName": CSRFName,
        "CSRFToken" : CSRFToken,
        "destination": "",
        "reqURI": ""
    }
    r = s.post(url, data,allow_redirects=False)
    print(r.text)
    if r.status_code != 200:
        print("[!] Username or password incorrect.")
        exit()
    print("[+] Loggin successful.")
    return s
    
if __name__ == '__main__':
    login()
  
